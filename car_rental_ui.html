<!DOCTYPE html>
<html>
<head>
    <title>Car Rental</title>
</head>
<body style="font-family: Arial; background: #f0f0f0; padding: 20px;">
    
    <!-- Login Screen -->
    <div id="loginScreen" style="background: white; padding: 40px; margin: 100px auto; width: 300px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
        <h1 style="text-align: center;">Car Rental</h1>
        <input type="text" id="username" placeholder="Username" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd;"/>
        <input type="password" id="password" placeholder="Password" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd;"/>
        <button onclick="login()" style="width: 100%; padding: 10px; background: blue; color: white; cursor: pointer; border: none; margin-top: 10px;">Login</button>
        <div id="loginMsg" style="margin-top: 10px; text-align: center; color: red;"></div>
    </div>
    
    <!-- User Dashboard -->
    <div id="userDashboard" style="display: none;">
        <h1 style="text-align: center;">User Dashboard</h1>
        <button onclick="logout()" style="float: right; padding: 8px 15px; background: red; color: white; cursor: pointer; border: none;">Logout</button>
        <div style="clear: both;"></div>
        
        <!-- View Cars -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; max-width: 900px;">
            <h2>Available Cars</h2>
            <button onclick="loadCars()" style="padding: 8px 15px; background: green; color: white; cursor: pointer; border: none;">Refresh</button>
            <div id="carsList" style="margin-top: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;"></div>
        </div>
        
        <!-- Book Car -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; width: 300px;">
            <h2>Book Car</h2>
            <input type="text" id="userCustId" placeholder="Customer ID" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <input type="text" id="userCarId" placeholder="Car ID" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <input type="number" id="userDays" placeholder="Days" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <button onclick="userBookCar()" style="width: 100%; padding: 10px; background: blue; color: white; cursor: pointer; border: none;">Book Car</button>
            <div id="userBookMsg" style="margin-top: 10px;"></div>
        </div>
        
        <!-- Release Car -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; width: 300px;">
            <h2>Release Car</h2>
            <input type="text" id="userReleaseRentalId" placeholder="Rental ID" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <button onclick="userReleaseCar()" style="width: 100%; padding: 10px; background: blue; color: white; cursor: pointer; border: none;">Release Car</button>
            <div id="userReleaseMsg" style="margin-top: 10px;"></div>
        </div>
    </div>
    
    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;">
        <h1 style="text-align: center;">Admin Dashboard</h1>
        <button onclick="logout()" style="float: right; padding: 8px 15px; background: red; color: white; cursor: pointer; border: none;">Logout</button>
        <div style="clear: both;"></div>
        
        <!-- Add Car -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; width: 400px;">
            <h2>Add Car</h2>
            <input type="text" id="carId" placeholder="Car ID" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <input type="text" id="carModel" placeholder="Model" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <input type="number" id="carRate" placeholder="Daily Rate" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <label style="display: block; margin: 10px 0 5px 0;">Car Image:</label>
            <input type="file" id="carImage" accept="image/*" style="width: 100%; padding: 5px; margin: 5px 0;"/>
            <button onclick="addCar()" style="width: 100%; padding: 10px; background: blue; color: white; cursor: pointer; border: none; margin-top: 10px;">Add Car</button>
            <div id="carMsg" style="margin-top: 10px;"></div>
        </div>
        
        <!-- Add Customer -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; width: 300px;">
            <h2>Add Customer</h2>
            <input type="text" id="custId" placeholder="Customer ID" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <input type="text" id="custName" placeholder="Name" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <input type="text" id="custPhone" placeholder="Phone" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <button onclick="addCustomer()" style="width: 100%; padding: 10px; background: blue; color: white; cursor: pointer; border: none;">Add Customer</button>
            <div id="custMsg" style="margin-top: 10px;"></div>
        </div>
        
        <!-- Available Cars -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; max-width: 900px;">
            <h2>Available Cars</h2>
            <button onclick="loadCars()" style="padding: 8px 15px; background: green; color: white; cursor: pointer; border: none;">Refresh</button>
            <div id="adminCarsList" style="margin-top: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;"></div>
        </div>
        
        <!-- Active Rentals -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; width: 500px;">
            <h2>Active Rentals</h2>
            <button onclick="loadRentals()" style="padding: 8px 15px; background: green; color: white; cursor: pointer; border: none;">Refresh</button>
            <div id="rentalsList" style="margin-top: 10px;"></div>
        </div>
        
        <!-- Return Car -->
        <div style="background: white; padding: 20px; margin: 10px; border-radius: 5px; width: 300px;">
            <h2>Return Car</h2>
            <input type="text" id="returnRentalId" placeholder="Rental ID" style="width: 100%; padding: 8px; margin: 5px 0;"/>
            <button onclick="returnCar()" style="width: 100%; padding: 10px; background: blue; color: white; cursor: pointer; border: none;">Return Car</button>
            <div id="returnMsg" style="margin-top: 10px;"></div>
        </div>
    </div>
    
    <script>
        const API = 'http://localhost:8080/api';
        let currentUser = null;
        
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (password !== 'password') {
                document.getElementById('loginMsg').innerText = '✗ Invalid password';
                return;
            }
            
            if (username === 'admin') {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userRole', 'admin');
                currentUser = 'admin';
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadCars();
                loadRentals();
            } else {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userRole', 'user');
                currentUser = username;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('userDashboard').style.display = 'block';
                loadCars();
            }
        }
        
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userRole');
            currentUser = null;
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        function checkLogin() {
            if (localStorage.getItem('isLoggedIn') === 'true') {
                const role = localStorage.getItem('userRole');
                currentUser = role === 'admin' ? 'admin' : localStorage.getItem('username') || 'user';
                document.getElementById('loginScreen').style.display = 'none';
                if (role === 'admin') {
                    document.getElementById('adminDashboard').style.display = 'block';
                    loadCars();
                    loadRentals();
                } else {
                    document.getElementById('userDashboard').style.display = 'block';
                    loadCars();
                }
            }
        }
        
        // Convert image to Base64
        function getBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        
        // ADMIN FUNCTIONS
        async function addCar() {
            const id = document.getElementById('carId').value;
            const model = document.getElementById('carModel').value;
            const rate = document.getElementById('carRate').value;
            const imageFile = document.getElementById('carImage').files[0];
            
            try {
                let imageBase64 = '';
                if (imageFile) {
                    imageBase64 = await getBase64(imageFile);
                }
                
                const res = await fetch(`${API}/cars`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: id,
                        model: model,
                        dailyRate: rate,
                        image: imageBase64
                    })
                });
                
                const data = await res.json();
                document.getElementById('carMsg').innerText = '✓ Car added!';
                document.getElementById('carMsg').style.color = 'green';
                document.getElementById('carId').value = '';
                document.getElementById('carModel').value = '';
                document.getElementById('carRate').value = '';
                document.getElementById('carImage').value = '';
                loadCars();
            } catch (err) {
                document.getElementById('carMsg').innerText = '✗ Error: ' + err.message;
                document.getElementById('carMsg').style.color = 'red';
            }
        }
        
        async function addCustomer() {
            const id = document.getElementById('custId').value;
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            
            try {
                const res = await fetch(`${API}/customers?id=${id}&name=${name}&phone=${phone}`, {method: 'POST'});
                const data = await res.json();
                document.getElementById('custMsg').innerText = '✓ Customer added!';
                document.getElementById('custMsg').style.color = 'green';
                document.getElementById('custId').value = '';
                document.getElementById('custName').value = '';
                document.getElementById('custPhone').value = '';
            } catch (err) {
                document.getElementById('custMsg').innerText = '✗ Error: ' + err.message;
                document.getElementById('custMsg').style.color = 'red';
            }
        }
        
        async function returnCar() {
            const rentalId = document.getElementById('returnRentalId').value;
            
            try {
                const res = await fetch(`${API}/rentals/${rentalId}`, {method: 'DELETE'});
                const data = await res.json();
                if (data.error) {
                    document.getElementById('returnMsg').innerText = '✗ ' + data.error;
                    document.getElementById('returnMsg').style.color = 'red';
                } else {
                    document.getElementById('returnMsg').innerHTML = `✓ Car returned!<br>Amount: ₹${data.cost}`;
                    document.getElementById('returnMsg').style.color = 'green';
                    document.getElementById('returnRentalId').value = '';
                    loadRentals();
                    loadCars();
                }
            } catch (err) {
                document.getElementById('returnMsg').innerText = '✗ Error: ' + err.message;
                document.getElementById('returnMsg').style.color = 'red';
            }
        }
        
        // USER & ADMIN FUNCTIONS
        async function loadCars() {
            try {
                const res = await fetch(`${API}/cars`);
                const cars = await res.json();
                let html = '';
                cars.forEach(car => {
                    const imgSrc = car.image || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="150"%3E%3Crect fill="%23ddd" width="200" height="150"/%3E%3Ctext x="50%" y="50%" text-anchor="middle" dy=".3em" fill="%23999"%3ENo Image%3C/text%3E%3C/svg%3E';
                    
                    html += `<div style="border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: white;">
                        <img src="${imgSrc}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 5px; margin-bottom: 10px;" alt="${car.model}"/>
                        <strong style="display: block; font-size: 16px;">${car.model}</strong>
                        <span style="color: #666; font-size: 14px;">ID: ${car.id}</span><br>
                        <span style="color: #2196F3; font-weight: bold; font-size: 16px;">₹${car.dailyRate}/day</span><br>
                        <span style="display: inline-block; margin-top: 5px; padding: 3px 8px; border-radius: 3px; font-size: 12px; font-weight: bold; background: ${car.available ? '#d4edda' : '#f8d7da'}; color: ${car.available ? '#155724' : '#721c24'};">
                            ${car.available ? '✓ Available' : '✗ Rented'}
                        </span>
                    </div>`;
                });
                if (currentUser === 'admin') {
                    document.getElementById('adminCarsList').innerHTML = html || 'No cars';
                } else {
                    document.getElementById('carsList').innerHTML = html || 'No cars available';
                }
            } catch (err) {
                const target = currentUser === 'admin' ? 'adminCarsList' : 'carsList';
                document.getElementById(target).innerText = 'Error: ' + err.message;
            }
        }
        
        async function loadRentals() {
            try {
                const res = await fetch(`${API}/rentals`);
                const rentals = await res.json();
                let html = '';
                rentals.forEach(rental => {
                    html += `<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                        <strong>Rental ${rental.id}</strong><br>
                        Customer: ${rental.customerId} | Car: ${rental.carId}<br>
                        Days: ${rental.days} | Cost: ₹${rental.totalCost}
                    </div>`;
                });
                document.getElementById('rentalsList').innerHTML = html || 'No active rentals';
            } catch (err) {
                document.getElementById('rentalsList').innerText = 'Error: ' + err.message;
            }
        }
        
        async function userBookCar() {
            const custId = document.getElementById('userCustId').value;
            const carId = document.getElementById('userCarId').value;
            const days = document.getElementById('userDays').value;
            
            try {
                const res = await fetch(`${API}/rentals?customerId=${custId}&carId=${carId}&days=${days}`, {method: 'POST'});
                const data = await res.json();
                if (data.error) {
                    document.getElementById('userBookMsg').innerText = '✗ ' + data.error;
                    document.getElementById('userBookMsg').style.color = 'red';
                } else {
                    document.getElementById('userBookMsg').innerHTML = `✓ Booked! Rental ID: ${data.rentalId}<br>Cost: ₹${data.totalCost}`;
                    document.getElementById('userBookMsg').style.color = 'green';
                    document.getElementById('userCustId').value = '';
                    document.getElementById('userCarId').value = '';
                    document.getElementById('userDays').value = '';
                    loadCars();
                }
            } catch (err) {
                document.getElementById('userBookMsg').innerText = '✗ Error: ' + err.message;
                document.getElementById('userBookMsg').style.color = 'red';
            }
        }
        
        async function userReleaseCar() {
            const rentalId = document.getElementById('userReleaseRentalId').value;
            
            try {
                const res = await fetch(`${API}/rentals/${rentalId}`, {method: 'DELETE'});
                const data = await res.json();
                if (data.error) {
                    document.getElementById('userReleaseMsg').innerText = '✗ ' + data.error;
                    document.getElementById('userReleaseMsg').style.color = 'red';
                } else {
                    document.getElementById('userReleaseMsg').innerHTML = `✓ Released! Amount: ₹${data.cost}`;
                    document.getElementById('userReleaseMsg').style.color = 'green';
                    document.getElementById('userReleaseRentalId').value = '';
                    loadCars();
                }
            } catch (err) {
                document.getElementById('userReleaseMsg').innerText = '✗ Error: ' + err.message;
                document.getElementById('userReleaseMsg').style.color = 'red';
            }
        }
        
        window.onload = checkLogin;
    </script>
</body>
</html>